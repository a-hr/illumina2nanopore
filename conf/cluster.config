executor {
    name = 'slurm'
    queueSize = 30 // The number of tasks the executor will handle in a parallel manner
    submitRateLimit = '1sec' // Determines the max rate of job submission per time unit, for example '10sec' (10 jobs per second)
    pollInterval = '1m' // The interval between polling for job status updates
}

process {
    errorStrategy = 'retry'
    maxRetries = 5

    withName: 'basecall' {
        container = 'genomicpariscentre/guppy-gpu'
        // nanozoo/guppy_gpu
        cpus = 24
        memory = '32 GB'
        time = '10h'
        clusterOptions = '--gres=gpu:p40:1'
    }

    withName: 'fastqc' {
        container = 'staphb/fastqc:latest'
        cpus = 8
        memory = '16 GB'
        time = '2h'
    }

    withName: 'multiqc' {
        container = 'ewels/multiqc:latest'
        cpus = 2
        memory = '4 GB'
        time = '1h'
    }
    
    withName: "demultiplex_orientation|demultiplex_bc|demultiplex_library|reverse_complement|stats|adapter_trim" {
        container = 'ahr1/demultiplex'
        cpus = 8
        memory = '16 GB'
        time = '2h'
    }

    withName: 'STAR_ALIGN' {
        container = 'ahr1/staraligner:2.7.10b'
        cpus = 12
        memory = '40 GB'
        time = '2h'
    }

    withName: "MINIMAP_ALIGN|MINIMAP_INDEX" {
        container = 'ahr1/minimap2:latest'
        cpus = 12
        memory = '40 GB'
        time = '2h'
    }

    withName: 'extract_UMI|dedup_UMI|BAM_INDEX|featureCounts' {
        container = 'ahr1/subread'
    }

    withName: 'group_results|plot_results' {
        container = 'ahr1/plotly'
    }
}

singularity {
    enabled     = true
    autoMounts  = true
    cacheDir    = "${baseDir}/containers"
}

docker.enabled = false